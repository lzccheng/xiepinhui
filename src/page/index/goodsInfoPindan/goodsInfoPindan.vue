<style scoped lang="less">
.page{
  width: 100%;
  overflow: hidden;
  background-color: #F8F8F8;
  // padding-bottom: 44/50rem;
}
contact-button {
  line-height: 20/50rem;
  padding-top: 6/50rem;
}

.kefu {
  line-height: 35/50rem;
  padding: 0;
  background: #fff;
  border-radius: 0;
}

.kefu .bottom-lable {
  margin-top: -14/50rem;
}

.kefu::after {
  display: none;
}

.icon-shoucangkong, .icon-yishoucang {
  font-size: 21pt;
  position: relative;
  top: -4/50rem;
}
.shoucang-lable {
  margin-top: -13/50rem !important;
}

.ad_popError {
  width: 100%;
  background: #de352d;
  color: #fff;
  height: 58/50rem;
  line-height: 58/50rem;
  font-size: 12pt;
  text-align: center;
  position: absolute;
  left: 0;
  top: 0;
  z-index: 9999;
}

.goods-silder {
  height: 375/50rem;
}

.goods-silder img {
  width: 100%;
  height: 100%;
}

.miaoshaTitle {
  width: 100%;
  vertical-align: middle;
}

.miaoshaTitle img {
  width: 100%;
  vertical-align: middle;
}

.num-panel {
  position: absolute;
  right: 15/50rem;
  margin-top: -20/50rem;
  z-index: 2;
  font-size: 10pt;
  color: #8d8c8b;
}

.goods-info {
  width: 100%;
  background: #fff;
  padding-top: 5/50rem;
}

.goodsinfo-name {
  width: 80%;
  padding: 5/50rem 15/50rem;
  font-size: 12pt;
}

.goods-info-bottom {
  padding: 0/50rem 15/50rem;
  padding-bottom: 10/50rem;
}

.price {
  color: #fb4c72;
  font-size: 10pt;
}

.row-huo {
  color: #ff4965;
  margin-right: 3/50rem;
}

.marketprice, .salenum {
  font-size:10pt;
  color: #888;
}

.share-box {
  padding-right: 15/50rem;
  color: #333;
}

.bottom-form {
  height: 100%;
  width: 60%;
  display: block;
}

.share-btn {
  padding: 0 !important;
  background: none;
  border: 0 !important;
  font-size: 20pt !important;
  box-shadow: 0;
  margin: 0;
  line-height: 25/50rem !important;
  color: #333 !important;
}

.share-title {
  font-size:9pt;
}

.share-btn:after {
  display: none;
}

.shuoming {
  background: #fff;
  padding: 5/50rem 15/50rem;
  line-height: 30/50rem;
}

.shuoming .iconfont {
  font-size: 10pt;
  color: red;
}

.shuoming span {
  color: #888;
}

.shuoming-youbian-hui {
  color: #888;
}

.bottom-box {
  position: fixed;
  bottom: 0;
  width: 7.50rem;
  height: 51/50rem;
  background: #fff;
  z-index: 3;
  align-items: center;
}

.fanli-box {
  padding: 5/50rem 0;
}

.fanli-mingpai {
  font-size: 8pt;
  border: 1/50rem #fde8ee solid;
  color: #f25;
  /* border-radius:10/50rem; */
  padding: 0/50rem 5/50rem;
  border-radius: 3/50rem;
  margin-right: 5/50rem;
}

.title {
  display: block;
  padding: 0/50rem 15/50rem;
  background: #fff;
  margin-top: 5/50rem;
  line-height: 35/50rem;
  font-size: 12pt;
  overflow: hidden;
}

.xq-title {
  text-align: center;
  display: block;
  padding: 0/50rem 15/50rem;
  background: #fff;
  margin-top: 5/50rem;
  line-height: 35/50rem;
  font-size: 12pt;
  overflow: hidden;
}

.xiangqing {
  font-size: 0;
}

.xiangqing img {
  width: 100%;
}

.nav-lable {
  font-size: 12pt;
}

.bottom-left {
  width: 20%;
  height: 100%;
  text-align: center;
  border-right: 1/50rem #f1f1f1 solid;
  color: #888;
}

.bottom-icon {
  font-size: 20pt !important;
}

.bottom-lable {
  display: block;
  font-size: 10pt;
  margin-top: -7/50rem;
}

.bottom-btn {
  width:50%;
  padding: 0 !important;
  height: 100%;
  color: #fff;
  border-radius: 0/50rem;
  line-height: 2.55 !important;
}

.bottom-btn::after {
  display: none;
}

.newprice {
  height: 50%;
  font-size: 10pt;
}

.btn-lable {
  font-size: 10pt;
  margin-top: -10/50rem !important;
  height: 50%;
}

.one {
  background: #61D8D0;
}

.two {
  background: #61D8D0;
}

.action-header {
  width: 100%;
  height: 80/50rem;
  position: fixed;
  top: 0;
  padding-left: 15/50rem;
}

.moren-img {
  width: 90/50rem;
  height: 90/50rem;
  margin-top: -20/50rem;
  position: fixed;
  z-index: 33;
  border-radius: 2/50rem;
}

.more-icon {
  top: 0;
}

.action-right {
  width: 100%;
  padding-top: 10/50rem;
  padding-left: 100/50rem;
  display: flex;
  flex-direction:column;
}

.action-right-lable {
  display: block;
  font-size: 11pt;
}

.info_choose {
  padding: 0/50rem 15/50rem;
}

.catalog_name {
  font-size: 10pt;
  padding-bottom: 10/50rem;
}

.catalog_items {
  padding-bottom: 10/50rem;
  border-bottom: 1/50rem #f1f1f1 solid;
  font-size: 12pt;
}

.select {
  text-align: center;
  border: 1/50rem solid #979797;
  color: #666;
  padding: 0/50rem 15/50rem;
  border-radius: 20/50rem;
  margin-bottom: 10/50rem;
  margin-right: 10/50rem;
}

.select-hui {
  text-align: center;
  border: 2/50rem solid #ddd;
  color: #ccc;
  padding: 0/50rem 15/50rem;
  border-radius: 20/50rem;
  margin-bottom: 10/50rem;
  margin-right: 10/50rem;
}

.select-active {
  padding: 0/50rem 15/50rem;
  text-align: center;
  background: #61D8D0;
  color: #fff;
  border-radius: 20/50rem;
  margin-bottom: 10/50rem;
  margin-right: 10/50rem;
}

.action-title {
  padding: 0/50rem 15/50rem;
  display: block;
  width: 100%;
  font-size: 10pt;
  padding-top: 10/50rem;
}

/*主容器*/

.stepper {
  width: 100/50rem;
  height: 26/50rem;
  /*给主容器设一个边框*/
  border: 1/50rem solid #ccc;
  border-radius: 3/50rem;
  margin-top: 15/50rem;
  margin-left: 15/50rem;
  margin-bottom: 51/50rem;
}

/*加号和减号*/

.stepper span {
  width: 28/50rem;
  line-height: 26/50rem;
  text-align: center;
  float: left;
}

/*数值*/

.stepper input {
  width: 40/50rem;
  height: 26/50rem;
  float: left;
  margin: 0 auto;
  text-align: center;
  font-size: 12/50rem;
  /*给中间的input设置左右边框即可*/
  border-left: 1/50rem solid #ccc;
  border-right: 1/50rem solid #ccc;
}

/*普通样式*/

.stepper .normal {
  color: black;
}

/*禁用样式*/

.stepper .disabled {
  color: #ccc;
}

.action-btn {
  position: fixed;
  width: 7.5rem;
  z-index: 3;
  bottom: 0;
  background-color: #fff;
}

.action-btn .btn {
  background: #61D8D0;
  line-height: 44/50rem;
  text-align: center;
  color: #fff;
  margin: 0.3rem auto;
}
.contt{
  width: 100%;
  position: absolute;
  left: 0;
  bottom: 0rem;
  background: #fff;
  // padding-bottom: 20/50rem;
}
.eva-box {
  background: #fff;
}

.evabox {
  background: #fff;
}

.evalist {
  background: #fff;
}

.eva-title {
  font-size: 11pt;
  padding: 5/50rem 15/50rem;
  background: #fff;
  margin-top: 5/50rem;
  line-height: 35/50rem;
}

.red-color {
  color: red !important;
}

.evalist-header {
  font-size: 10pt;
  padding: 10/50rem 15/50rem;
  padding-bottom: 5/50rem;
}

.eva-btn-bottome {
  text-align: center;
  padding-bottom: 5/50rem;
  padding-top: 5/50rem;
  color: #666;
}

.icon-yuanyou {
  margin-left: 5/50rem;
}

.all-eva-btn {
  font-size: 9pt;
  padding: 2/50rem 15/50rem;
  border: 1/50rem #f1f1f1 solid;
  text-align: center;
  border-radius: 10/50rem;
}

.eva-img {
  width: 30/50rem;
  height: 30/50rem;
  border-radius: 100%;
  margin-right: 10/50rem;
}

.eva-list-center {
  padding: 5/50rem 15/50rem;
  font-size: 9pt;
  color: #444;
}

.eva-list-bottom {
  padding: 0/50rem 15/50rem;
  font-size: 9pt;
  color: #888;
  padding-bottom: 5/50rem;
}

.eva-list-bottom .time {
  font-size: 9pt;
  padding-right: 5/50rem;
}

.eva-list-img {
  padding: 0/50rem 15/50rem;
  background: #fff;
  position: relative;
}

.eva-list-img img {
  width: 25%;
  min-width: 70/50rem;
  height: 80/50rem;
  padding: 5/50rem;
  padding-left: 0/50rem;
}

.eva-all-img {
  background: rgba(255, 255, 255, 0.6);
  font-size: 12pt;
  position: absolute;
  z-index: 2;
  right: 15/50rem;
  bottom: 5/50rem;
  border-radius: 10/50rem;
  padding: 0/50rem 10/50rem;
}
/* 优惠券 */
.coupon-box {
  padding: 10/50rem 15/50rem;
  background: #fff;
  position: relative;
  color: #888;
  font-size: 12pt;
}

.coupon-box img {
  width: 20%;
  margin-right: 20/50rem;
}

.coupon-lingqu {
  background: transparent;
  color: red;
  position: absolute;
  right: 0/50rem;
  top: 3/50rem;
  font-size: 12pt;
}

.coupon-action-scroll {
  overflow: scroll;
  padding-top: 20/50rem;
}

.coupon-action-top {
  width: 100%;
  text-align: center;
  line-height: 44/50rem;
}

.coupon-action-box {
  width: 90%;
  margin: auto;
  padding: 5/50rem 0;
  background: url(https://m.xiepinhui.com.cn/img/nine/coupon/cpBg.png) no-repeat;
  background-size: 100% 100%;
  margin-bottom: 10/50rem;
}

.lingqu-coupon-action-box {
  width: 90%;
  margin: auto;
  padding: 5/50rem 0;
  background: url(https://m.xiepinhui.com.cn/img/nine/coupon/cpBg1.png) no-repeat;
  background-size: 100% 100%;
  margin-bottom: 10/50rem;
}

.action-box-left {
  width: 31%;
  color: #fff;
  text-align: center;
  border-right: 2/50rem #f1f1f1 dashed;
}

.action-box-left .fuhao {
  font-size: 10pt;
}

.action-box-left .price {
  font-size: 18pt;
  color: #fff;
}

.action-box-center {
  width: 55%;
  line-height: 30/50rem;
  text-align: center;
  color: rgba(255, 255, 255, 1);
}

.coupon-title {
  font-size: 12pt;
}

.coupon-time {
  font-size: 8pt;
}

.action-box-right {
  width: 24%;
  text-align: center;
}

.action-box-right img {
  width: 55/50rem;
  height: 55/50rem;
  margin-top: 10/50rem;
}

.close-icon {
  font-size: 20pt;
  position: absolute;
  right: 10/50rem;
  color: #666;
}

/* 商家活动 */

.scroll-box {
  padding: 0 10/50rem;
  position: relative;
  vertical-align: middle;
  background: #fff;
  padding-bottom: 10/50rem;
}

.recommend_scroll_x_box {
  width:900/500rem;
  margin: auto;
  white-space: nowrap;
  display: flex;
  overflow: scroll;
}

::-webkit-scrollbar {
  width: 0;
  height: 0;
  color: transparent;
}

.recommend_hot_box {
  width: 25%;
  margin-right: 10/50rem;
  display: inline-block;
  text-align: center;
  border-radius: 3/50rem;
}

.recommend_hot_image {
  padding: 5/50rem;
  color: #fff;
}

.news-coupon-fuhao {
  font-size: 8pt;
}

.news-coupon-num {
  font-size: 14pt;
}

.news-cpupon-shuoming {
  font-size: 10pt;
}

.lingqu {
  background: rgba(213, 213, 213, 1) !important;
}

.no-lingqu {
  background: linear-gradient(to left, rgba(247, 126, 152, 1), rgba(247, 93, 149, 1));
  /* background:rgba(255,74,138,1); */
}

.rebate-box {
  height: 50/50rem;
  line-height: 50/50rem;
  font-size: 28/50rem;
  color: #F75D95;
  padding: 0 40/50rem 0 15/50rem;
  position: relative;
  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAO0AAABOCAMAAAD7G2H9AAAAh1BMVEUAAAD7TnT8THP8THL8THL/Xof8TXL/T3T/co78THL8THL8THL8THP8TXP7TXP8TXP8TXP/VHr7TXL7TXL/UHX7TXP8TXL8TXL8TXP9TXT9TXP8T3P/T3f/U3r/U3T/UHf/apf8THL9TXP8TXP9TnP9TXP8TXP7TXT/TnL/TnX7T3T7THL7THI+MyP6AAAALHRSTlMAgP357QisLQT05d+1koldSw7MxyXWwL2admVTIBoXEwKjeqdvbVVCOzdEQ86EPDYAAAFGSURBVHja7dwHboNAEIXhB+xSvKZjMMYF95S5//miXCN/5gafhMROlYGil40RJFKrZZEgkTrP0Z6TShxtZANHm2+24mgXa0DaKawc7WA3cbRlcuZovbuKoz3YB0jbdeJoP+0A0l6LlqO9JKU42tkGjnYNkzjaxhaQdrvJOdpjHImjreITR+tdKo62tjdI2+/E0Wb2BGn3RcvRtsVeHO3DMpB214uj/bIapE2d52hPcSWONoqPHO1vp4ujfVkD0o5BHG1mM0hbJpd/7R8N1pesKawg7YL6A7FeF6yXIywrYGV8eqOyeValRk9UFY5VYWVVz5XZA6Rldb1U2zdIy+pWsyYRYFMmrAkiNfYCadcwgrSaLQNpWRO7rGls2KQ9a4sCtiHj3R2kZW22wbYWNYUcpGVtG7M2yXUjXQmAXYDQ3Xna5RZQdD+yhHIobY9CdAAAAABJRU5ErkJggg==");
  background-size: 100% 100%;
  background-repeat: no-repeat;
}
.spanCol{
  color: #999;
}
.shuoming-bottom-btn {
  width: 7.5rem;
  line-height: 44px;
  position: fixed;
  bottom: 0;
  left: 50%;
  margin-left: -3.75rem;
  text-align: center;
  color: #fff;
  background: #61D8D0;
  font-size: 12pt;
  z-index: 2;
}
.alert{
  background: rgba(0, 0, 0, 0.7);
  height: 100%;
  width: 7.50rem;
  position: fixed;
  top: 0;
  left: 50%;
  margin-left: -3.75rem;
  z-index: 20;
  .con{
   position: absolute;
   left: 0;
   bottom: 0;
   padding-bottom: 44/50rem;
  }
}
/* 推荐商品 */

.tj-title {
  width: 100%;
  vertical-align: middle;
  font-size: 0;
}

.tj-title img {
  width: 100%;
}
.action-border{
  // position: absolute;
  // bottom: 0;
  // left: 0;
  // width: 100%;
}
.shuoming-content .shuoming-title {
  font-size: 12pt;
}
.swiper-pagination-bullet-active{
    opacity: 1;
    background-color: #fff !important;
}
.tabList1{
  position: relative;
  width: 90%;
  margin: 0 auto;
  background-color: #fff;
  .list1{
    -webkit-justify-content: space-around;
    -moz-justify-content: space-around;
    -ms-justify-content: space-around;
    -o-justify-content: space-around;
    justify-content: space-around;
  }
  div{
    padding: 4/50rem 0;
  }
  .line1{
    transition: all 0.5s;
    position: absolute;
    left: 0;
    bottom: -2/50rem;
    width: 50/50rem;
    height: 3/50rem;
    border-radius: 5px;
    padding: 0;
    background-color: #61D8D0;
  }
}
.topTab{
  background-color: #fff;
  position: fixed;
  z-index: 55;
  width: 7.5rem;
  border-bottom: #eee solid 1px;
  .tabBack{
    position: absolute;
    top: 0.3rem;
    left: 0.3rem;
    width: 0.25rem;
    height: 0.25rem;
    transform: rotate(-45deg);
    border-top: 1px solid #555;
    border-left: 1px solid #555;
    z-index: 999;
  }
}
.itemList1{
  padding-top: 40/50rem;
  // overflow: auto;
}
.page{
  width:7.5rem;
}

.my-bullet-active{
  opacity: 1;
  background: red;
}
.my-bullet{
  opacity: 1;
  border-radius: .02rem;
  width: .4rem;
  height: .4rem;
  margin: 0 .03rem;
  display: inline-block;
  background: rgba(0,0,0,0.20)}
.backBtn{
  color: #fff;
  height: 0.8rem;
  line-height: 0.8rem;
  padding: 0rem 0.8rem;
  background-color: #61D8D0;
  border-radius: 0.2rem;
  display: inline-block;
  margin: 0.3rem 0.5rem;
}
</style>
<template>
    <div>
        <!-- <x-header :left-options="{backText:''}" :title="nvabarData.title" id="vux-header"></x-header> -->
        <loading type="type3" v-if="loadingShow"></loading>
        
        <div class="page" v-if="spec_info != ''">
            <div class="topTab">
              <div class="tabBack" @click="routerBack"></div>
              <div class="tabList1">
                <div class="list1 flex">
                  <div @click="tabClick($event,index)" v-for="(item, index) in tab" :key="index">{{item}}</div>
                </div>
                <div class="line1" ref="line" :style="{'left': lineLeft + 'px'}"></div>
              </div>
            </div>
            <div class="itemList1">
              <div class="swiper-container swiperSel">
                <div class="swiper-wrapper">
                  <div class="item swiper-slide">
                    <div class="silder-box">
                        <swiper :options="swiperOption">
                          <swiper-slide class="goods-silder" v-for="(slide,index) in goodsInfo.goods_image_arr" :key="index">
                            <img v-preview="slide" :src="slide" alt="" class="slide-image">
                          </swiper-slide>
                          <div class="swiper-pagination" slot="pagination"></div>
                        </swiper>
                    </div>
                    <div class="miaoshaTitle" v-if="goodsInfo.coupon_type=='1'">
                      <img src="~@/assets/images/miaosha/haohuan_title.png" alt="">
                    </div>
                    <div class="goods-info line_xi_after">
                      <div class='flex flex-align-center flex-pack-justify'>
                        <span class="goodsinfo-name">
                          <span class="haohuo-mingpai" v-if="goodsInfo.s_type==2">好货专享</span>
                          {{goodsInfo.goods_name}}
                        </span>
                      </div>
                      <div class="goods-info-bottom ">
                        <div class='flex flex-align-center flex-pack-justify'>
                            <span class="price padd-top">价格:￥{{goodsInfo.purchase_price}}</span>
                            <span class="salenum padd-top">销量:{{goodsInfo.goods_salenum}}件</span>
                        </div>
                        <div class='fanli-box flex flex-align-center' :class="{'flex-pack-end': partner_type==0,'flex-pack-justify': partner_type!=0}">
                          <div class="rebate-box" v-if="partner_type=='1'||partner_type=='2'">
                            返利：{{goodsInfo.purchase_rate}}
                          </div>
                        </div>
                      </div>
                      <div class="now-activity flex flex-align-center flex-pack-justify" @click="openActivity" v-if="goodsInfo.activity_other==1">
                        <div class=' flex flex-align-center'>
                          <img src="~@/assets/images/goodsInfo/activity_kanjia.png" v-if="goodsInfo.activity_type=='3'" alt="">
                          <img src="~@/assets/images/goodsInfo/activity_miaosha.png" v-if="goodsInfo.activity_type=='9'" alt="">
                          <img src="~@/assets/images/goodsInfo/activity_zhekou.png" v-if="goodsInfo.activity_type=='10'" alt="">
                          <span>{{goodsInfo.activity_other_title}}</span>
                        </div>
                        <span class="iconfont icon-youbian"></span>
                      </div>
                    </div>
                    <div>
                      <div class="shuoming flex flex-align-center flex-pack-justify" @click="coupon_actionSheetbindchange">
                        <div class='iconfont icon-duihao'>
                          <span class="spanCol">&nbsp;&nbsp;全场包邮</span>
                        </div>
                        <div class='iconfont icon-duihao'>
                          <span class="spanCol">&nbsp;&nbsp;7天发货</span>
                        </div>
                        <div class='iconfont icon-duihao'>
                          <span class="spanCol">&nbsp;&nbsp;法定三包</span>
                        </div>
                        <div class='iconfont icon-duihao'>
                          <span class="spanCol">&nbsp;&nbsp;假一赔十</span>
                        </div>
                        <span class="iconfont icon-youbian shuoming-youbian-hui"></span>
                      </div>
                      
                      
                    </div>
                    <div class='eva-title flex flex-pack-justify  flex-align-center '>
                      <span>商品评价({{goodsInfo.eval_num}})</span>
                      <div class="flex flex-align-center more-title" v-if="goodsInfo.eval_num!=0">
                        <div>好评率
                          <span class='red-color'>{{goodsInfo.eval_percent}}</span>
                        </div>
                      </div>
                    </div>
                    <div class="tj-bottom-more" @click="allEva" style="border-top: 1px solid #f8f8f8;border-bottom: 8px solid #f8f8f8;padding: 10px;">
                          查看全部评价
                        <span class="iconfont icon-yuanyou"></span>
                    </div>
                    <div v-if="tj_info!=''">
                      <div class="tj-title">
                        <img src="~@/assets/images/goodsInfo/tj_title.png" alt="">
                      </div>
                      <div class="silder-tj-box" :style='{"height":tj_height+"px"}'>
                        <swiper :options="swiperOption2" class="tj-silder">
                          <swiper-slide class="tj-box flex flex-warp flex-align-center flex-pack-justify" v-for="(slide,index) in tj_info" :key="index">
                            <div v-for="(item_list,idx) in slide" :key="idx" @click="opengoodsInfo(item_list.n_goods_id)" class="tj_list ">
                              <img :src="item_list.goods_image" alt="">
                              <div class="tj-goods-name">{{item_list.goods_name}}</div>
                              <div class="tj-goods-price">￥{{item_list.group_price}}</div>
                            </div>
                          </swiper-slide>
                          <div class="swiper-pagination2" slot="pagination" style="text-align: center;"></div>
                        </swiper>
                        <div class="tj-bottom-more">
                          查看更多热卖推荐
                          <span class="iconfont icon-yuanyou"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="item swiper-slide">
                    <div>
                      <div class="xiangqing" v-for="(item,index) in goodsinfoImage" :key="index">
                        <img :src="item" class="xiangqing" alt="">
                      </div>
                    </div>
                  </div>
                  <div class="item swiper-slide">
                    <div>
                      <alleva :goodsid="goodsId" @conFn="swiperContent"></alleva>
                    </div>
                  </div>
                </div>
              </div>
              
            </div>
            <div class="bottom-box flex ">
                <span class="bottom-left kefu">
                    <span class='iconfont icon-xiaoxi bottom-icon'></span>
                    <span class='bottom-lable'>客服</span>
                </span>
                <div class="bottom-left" v-if="goodsInfo.collect_goods==1" @click="scGoods(2)">
                    <span style='color:#FB4C72' class='iconfont icon-shoucangkong'></span>
                    <span class='bottom-lable shoucang-lable'>收藏</span>
                </div>
                <div class="bottom-left" v-else @click="scGoods(1)">
                    <span class='iconfont icon-shoucangkong'></span>
                    <span class='bottom-lable shoucang-lable'>收藏</span>
                </div>
                <div class="bottom-form">
                    <div class="bottom-btn one" style="width: 100%;text-align: center" @click="actionSheetTap('buy','')">
                        <div class="newprice">￥{{goodsInfo.purchase_price}}</div>
                        <div class='btn-lable'>购买</div>
                    </div>
                </div>
            </div>
            <div class="alert " @click.self="hideAlert('actionSheetHidden')" v-if="actionSheetHidden && goodsInfo">
              <div class="contt" :class="actionSheetHidden?'bounceIn':''">
                <div class="action-border" >
                  <div class="action-header flex con" >
                    <img :src="goodsInfo.goods_image_arr[0]" class="moren-img" alt="">
                    <div class='action-right' style="flex: column;">
                      <span class="action-right-lable" v-if="btnType=='buy'">￥{{goodsInfo.purchase_price}}</span>
                      <span class="action-right-lable" v-else>￥{{goodsInfo.group_price}}</span>
                      <span class="action-right-lable">{{nowSelectspec.spec}}</span>
                      <span class="action-right-lable" v-if="goodsInfo.is_present=='1'">库存:现生产(7天内发货)</span>
                      <span class="action-right-lable" v-else-if="goodsInfo.is_present=='2'">库存:15-30天定制</span>
                      <span class="action-right-lable" v-else>库存：{{nowSelectspec.goods_storage}}</span>
                    </div>
                    <div class="close-icon iconfont icon-guanbi" @click="actionSheetbindchange"></div>
                  </div>
                </div>
                <div style="height: 250px;margin-top:100px;padding-bottom:44px; overflow: scroll;" v-if="spec_info">
                  <div class="info_choose " v-for="(specBox, Idx) in spec_info.goods_specname" :key="Idx">
                    <div v-if="Idx==0">
                      <div class="catalog_name">{{specBox.sp_name}}</div>
                      <div class="catalog_items flex flex-warp ">
                          <div v-for="(specName, index) in specBox.values" :key="index">
                              <div @click="clickNum(index,Idx,specBox.sp_name+':'+specName)" :class="{'select-active': specIndex[Idx] === index,'select': specIndex[Idx] !== index}">{{specName}}</div>
                          </div>
                      </div>
                    </div>
                    <div v-if="Idx==1">
                      <div class="catalog_name">{{specBox.sp_name}}</div>
                      <div class="catalog_items flex flex-warp ">
                          <div v-for="(specName,index) in specBox.values" :key="index">
                            <div @click="clickNum(index,Idx,specBox.sp_name + ':' + specName)" v-if="nowList[index].goods_storage!=0" :class="{'select-active': specIndex[Idx] === index,'select': specIndex[Idx] !== index}">
                                {{specName}}
                            </div>
                            <div class="select-hui" v-else>{{specName}}</div>
                          </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="action-btn">
                  <div class="btn" @click="goBuy">
                    <span v-if="btnType=='pindan'">确认拼单</span>
                    <span v-else>确认购买</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="alert" @click.self="hideAlert('coupon_actionSheetHidden')" v-show="coupon_actionSheetHidden" >
              <div style="width:100%;  overflow: hidden;" class="shuoming con" :class="coupon_actionSheetHidden?'bounceIn':''">
                <div class="coupon-action-top ">服务说明</div>
                <div class="coupon-action-scroll" style="width:100%; height:300px;">
                  <div class="fuwu-shuoming flex " v-for="(item, index) in goodsInfo.instructions" :key="index">
                    <div class="fuwu-left-icon iconfont icon-duihao"></div>
                    <div class="shuoming-content">
                      <div class="shuoming-title">{{item.title}}</div>
                      <div class="shuoming-text">{{item.info}}</div>
                    </div>
                  </div>
                  <div class="shuoming-bottom-btn" @click="coupon_actionSheetbindchange">我知道了</div>
                </div>
              </div>
            </div>
        </div>
        <div v-if="spec_info == '' && backBtnBool" class="backBtn" @click="routerBack">返回</div>
    </div>
</template>
<script>
import 'swiper/dist/css/swiper.css';
import './swiper_dor.less';
import loading from "@/components/loading.vue";
import alleva from './alleva.vue';
import { Group, Cell, XButton, Badge, XHeader, ConfirmPlugin ,XSwitch } from "vux";
import { mapGetters, mapActions, mapMutations } from "vuex";
import Swiper from 'swiper';
import { api } from "@/utils/api.js";
import { share } from "@/utils/wx_sdk.js";
import comm from "@/utils/comm.js";
import { swiper, swiperSlide } from 'vue-awesome-swiper';
import fancyBox from 'vue-fancyBox';
import { isScrollBottom } from "@/utils/comm.js";
import { setTimeout } from 'timers';
import 'animate.css';

export default {
    components: {
        loading,
        XHeader,
        swiper,
        swiperSlide,
        alleva
    },
    data(){
        return {
            slide: true,
            swiperOption: {
              autoplay: true,
              pagination: {
                el: '.swiper-pagination',
                // bulletClass: 'my-bullet',
                // bulletActiveClass: 'my-bullet-active',
                clickable: true
              }
            },
            swiperOption2: {
              pagination: {
                el: '.swiper-pagination2',
                // bulletActiveClass: 'my-bullet-active',
              }
            },
            backBtnBool: false,
            tab: ['商品','详情','评价'],
            currentBarIndex: 0,
            lineLeft: 0,
            loadingShow: true,
            actionSheetHidden: false,
            coupon_actionSheetHidden: false,
            goodsId: "",
            goodsInfo: "",
            allIndex: "",
            nowIndex: "",
            spec_info: "",
            goods_specname: "",
            all_spec_goodid: "",
            nowSelectspec: "",
            specIndex: "",
            num: 1,
            goodsinfoImage: "",
            minusStatus: 'disabled',
            btnType: "",
            grouplist: "",
            timeList: {},
            isShow: false,
            group_id: "",
            partner_type: "0",
            coupon_list: "",
            select: "",
            nowList: "",
            nowClick: "",
            yiselect: "",
            tj_info: "",
            tj_height: "",
            goodstype: 1,
            imgHeight:"",
            // 组件所需的参数
            nvabarData: {
                showCapsule: 1, //是否显示左上角图标
                title: '鞋品荟', //导航栏 中间的标题
            },
        }
    },
    created(){
      if(this.$route.query.shareCode){
        this.$store.dispatch('update_shareCode',this.$route.query.shareCode);
      }
    },
    destroyed () {
        window.onscroll = null;
    },
    mounted(){
        this.$vux.loading.show({
            text: "加载中..."
        });
        this.goodsId = this.$route.query.goodsId;
        this.goodstype = this.$route.query.goodstype || 1;
        this.showXiangqing();
        this.getData();
        this.bangding();
    },
    methods: {
        async bangding(){
          var version = "";
          let shareCode = this.$route.query.shareCode || this.$store.state.center.shareCode;
          if(shareCode){
            let data = {
              plat: 3,
              account: this.account,
              token: this.token,
              code: shareCode,
              version
            }
            const [err, res] = await api.bindrebate(data);
            if(err){
                this.$vux.toast.text(err.msg);
                return;
            }
          }
          
        },
        async getData(){
            let data = {
                plat: 3,
                n_goods_id: this.goodsId
            }
            // 商品规格
            const [err, res] = await api.goodsspec(data);
            this.loadingShow = false;
            this.backBtnBool = true;
            this.getBarLeft(0);
            if(err){
                this.$vux.toast.text(err.msg);
                return;
            }
            if(res.code == 2000){
                var param = {};
                var select = {};
                var yiselect = {};
                for (var i = 0; i < res.data.goods_specname.length; i++) {
                    if (res.data.goods_specname[i].sp_name == "颜色") {
                        if (res.data.goods_specname[i].values.length == 1) {
                            var string = i;
                            param[string] = 0;
                            select[string] = res.data.goods_specname[i].sp_name + ":" + res.data.goods_specname[i].values[0];
                            yiselect[string] = 0;
                        } else {
                            var string = i;
                            param[string] = "";
                            select[string] = ""
                            yiselect[string] = ""
                        }
                    } else {
                        var string = i;
                        param[string] = "";
                        select[string] = "",
                        yiselect[string] = ""
                    }
                }
                this.spec_info = res.data;
                this.specIndex = param;
                this.select = select;
                this.nowSelectspec = res.data.all_spec_goodid[0];
                this.yiselect = yiselect;
                this.spaceStorage();
            }
            // 商品详情图片
            const [_err, _res] = await api.goodsimgarr(data);
            if(_err){
                this.$vux.toast.text(_err.msg);
                return;
            }
            if(_res.code == 2000){
                this.goodsinfoImage = _res.data.goods_body
            }
            this.showPindan(this);
            this.newWiperBarFn();
        },
        newWiperBarFn(){
          let  that = this;
          this.newWiperBar = new Swiper('.swiperSel',{
            autoplay: false,
            autoHeight: true,
            on: {
              slideChangeTransitionStart: function(){
                that.swiperContent()
              }
            }
          });
        },
        actionSheetbindchange(){
          this.actionSheetHidden = !this.actionSheetHidden;
        },
        spaceStorage(){
            var nowSpaceTitle = "";
            var nowList = [];
            if (this.specIndex[0] != "") {

            }
            for (var i in this.select) {
                if (i == 0) {
                    nowSpaceTitle = this.select[i];
                }
            }
            for (var d = 0; d < this.spec_info.all_spec_goodid.length; d++) {
                var text = this.spec_info.all_spec_goodid[d].spec;
                if (text.indexOf(nowSpaceTitle) == 0) {
                    nowList.push(this.spec_info.all_spec_goodid[d])
                }
            }
            this.nowList = nowList;
        },
        async showPindan(that){
            that.grouplist = '';
            let data = {
                plat: 3,
                num: 5,
                goods_id: this.goodsId
            }
            const [err, res] = await api.groupinglist(data);
            if(err){
                this.$vux.toast.text(err.msg);
                return;
            }
            if(res.code == 2000){
                this.grouplist = res.data.data;
                var list = {};
                for (var i = 0; i < res.data.list.length; i++) {
                    var endsStr = res.data.list[i].end_time.replace(/-/g, '/');
                    var nowTimeStr = res.data.list[i].now_time.replace(/-/g, '/');
                    var totalSecond = Date.parse(endsStr) / 1000 - Date.parse(nowTimeStr) / 1000;
                    // comm.daojishi(totalSecond, that, i, list, app);
                }
            }
        },
        async showXiangqing(){
            let that = this;
            let data = {
                plat: '3',
                n_goods_id: this.goodsId,
                account: this.account,
                token: this.token,
                type: this.goodstype
            }
            const [err, res] = await api.newgoodsdetail(data);
            this.$vux.loading.hide()
            if(err){
                this.$vux.toast.text(err.msg);
                return;
            }
            if(res.code == 2000){
                this.goodsInfo = res.data;
                this.allIndex = res.data.goods_image_arr.length,
                this.nowIndex = "1";
                let data = {
                  plat: 3,
                  account: this.account,
                  token: this.token
                }
                const [err_, res_] = await api.getsharecode(data);
                if(res_.code == 2000){
                  let shareConfig = {
                    title: '鞋品荟邀请您',
                    desc: that.goodsInfo.group_price + "元抢真皮鞋还包邮,全场新品任你挑!",
                    imgUrl: that.goodsInfo.goods_image_arr[0],
                    link: window.location.origin + '?url=/index/goodsInfoPindan&goodsId=' + this.goodsId+'&shareCode=' + res_.data.code
                  }
                  console.log(res_,66666666666,shareConfig)
                  share(this,{share: shareConfig})
                }
            }
            
            this.nvabarData = {
                showCapsule: 1,
                title: res.data.goods_name, //导航栏 中间的标题
            }
            if(this.$route.meta && this.$route.meta.title){
              this.$route.meta.title = this.nvabarData.title;
            }
            that.showTuijian(app, res.data.group_price, that)
        },
        callback(){

        },
        openActivity(){

        },
        opengoodsInfo(goodsId){
          this.$router.push({
            path: '/index/goodsInfoPindan',
            query: {
              goodsId
            }
          })
        },
        coupon_actionSheetbindchange(){
          this.coupon_actionSheetHidden = !this.coupon_actionSheetHidden;
        },
        async showTuijian(app, type_price, that){
          let data = {
            plat: 3,
            num: 24,
            type_price,
            sex: 0
          }
          const [err, res] = await api.commendgoods(data);
          if(err){
              this.$vux.toast.text(err.msg);
              return;
          }
          if(res.code == 2000){
            var tujianLent = res.data.length;
            var lent_item = Math.ceil(tujianLent / 6)
            var tuijianInfo = [];
            for (var b = 0; b < lent_item; b++) {
              tuijianInfo.push(res.data.splice(0, 6));
            }
            if (tujianLent > 0) {
              if (tuijianInfo[0].length > 3) {
                that.tj_height = 420;
              } else {
                that.tj_height = 210;
              }
            }
            that.tj_info = tuijianInfo;
            that.tj_height = that.tj_height
          }
        },
        actionSheetTap(id,groupid){
          this.isShow = true;
          this.actionSheetHidden = !this.actionSheetHidden;
          this.btnType = id;
          this.group_id = groupid;
        },
        clickNum(num,fatherindex,value){
            let that = this;
            var ss = this.nowSelectspec.spec.split(",");
            var spec = this.specIndex;
            var yiselect = that.select;
            if (spec[fatherindex] === num) {
              spec[fatherindex] = "";
              yiselect[fatherindex] = "";
            } else {
              spec[fatherindex] = num;
              yiselect[fatherindex] = value;
            }
            // 当前选择的规格类型
            this.specIndex = this.specIndex;
            this.nowClick = fatherindex;
            this.yiselect = yiselect;
            //选中的规格组合，拆分成数组然后修改选中的值
            ss[fatherindex] = value;
            var str = "";
            for (var n = 0; n < ss.length; n++) {
              if (n == 0) {
                str = ss[n];
              }
              else {
                str = str + "," + ss[n]
              }
            }
            // 匹配相对应的规格组合
            for (var i = 0; i < that.spec_info.all_spec_goodid.length; i++) {
              if (str == that.spec_info.all_spec_goodid[i].spec) {
                this.nowSelectspec = that.spec_info.all_spec_goodid[i];
              }
            }
            this.spaceStorage();
        },
        spaceStorage(){
            var nowSpaceTitle = "";
            var nowList = [];
            if (this.specIndex[0] != "") {

            }
            for (var i in this.select) {
              if (i == 0) {
                nowSpaceTitle = this.select[i];
              }
            }
            for (var d = 0; d < this.spec_info.all_spec_goodid.length; d++) {
              var text = this.spec_info.all_spec_goodid[d].spec;
              if (text.indexOf(nowSpaceTitle) == 0) {
                nowList.push(this.spec_info.all_spec_goodid[d])
              }
            }
            this.nowList = nowList;
        },
        //去购买
        goBuy(){
          if(this.yiselect[0] == "" || this.yiselect[1] == "" || this.nowSelectspec.goods_storage == 0){
            return this.$vux.toast.text("请选择商品规格");
          }
          var that = this;
          var goodsprice;
          if (this.btnType == "pindan") {
            goodsprice = this.goodsInfo.group_price;
          } else if (this.btnType == "buy") {
            goodsprice = this.goodsInfo.purchase_price;
          }
          this.actionSheetHidden = !this.actionSheetHidden;
          let goodsInfo = {
            goodspec: this.nowSelectspec,
            goodsimg: this.goodsInfo.goods_image_arr[0],
            goodsname: this.goodsInfo.goods_name,
            goodsprice: goodsprice,
            goods_id: this.goodsInfo.n_goods_id,
            btnType: this.btnType
          }
          this.$store.dispatch('update_goodsInfo',goodsInfo);
          // return
          this.$router.push({
            path: '/index/orderInfo_pd',
            query: {
              group_id: this.group_id
            }
          })
        },
        getBarLeft(i){
          this.$nextTick(()=>{
            if(this.$refs.line){
              let parent = this.$refs.line.parentNode.firstChild.children;
              let brother = parent[i];
              this.lineLeft = brother.offsetLeft - (this.$refs.line.clientWidth - brother.clientWidth)/2;
            }
          })
        },
        tabClick(e,i){
          // this.getBarLeft(i);
          this.newWiperBar.slideTo(i,500,false);
          this.swiperContent()
        },
        swiperContent(){
          let that = this;
          this.$nextTick(()=>{
            if(!that.newWiperBar)return;
            that.getBarLeft(that.newWiperBar.activeIndex);
            let height = that.newWiperBar.slides[that.newWiperBar.activeIndex].clientHeight;
            // console.log(that.newWiperBar.activeIndex)
            that.newWiperBar.el.style.height = height + 'px';
            // window.scrollTo(0,0);
          })
        },
        showEvaImg(item,geval_images){

        },
        hideAlert(key){
          this[key] = false;
        },
        preventDefault(e){
          e.preventDefault();
          return false;
        },
        allEva(){
          this.newWiperBar.slideTo(2);
        },
        oppenImg(e,imgs){
          let imgList = [];
          imgs.forEach((item)=>{
            let data = {};
            data.width = 200;
            data.height = 200;
            data.url = item;
            imgList.push(data);
          })
          this.$nextTick(()=>{
            fancyBox(e.target,imgList);
          })
          
        },
        async scGoods(type){
          this.$vux.loading.show();
          let data = {
            plat: 3,
            account: this.account,
            token: this.token,
            goods_id: this.goodsId,
            type: 1
          }
          let _err, _res, collect_goods;
          switch(type){
            case 1:
              [_err, _res] = await api.collectgoods(data);
              collect_goods = 1;
              break;
            case 2:
              [_err, _res] = await api.cancelcollectgoods(data);
              collect_goods = 0;
              break;
          }
          if(_err){
              this.$vux.toast.text(_err.msg);
              return;
          }
          if(_res.code == 2000){
            this.$vux.toast.text(_res.msg);
            this.goodsInfo.collect_goods = collect_goods;
          }
        },
        routerBack(){
          let shareCode = this.$route.query.shareCode || this.$store.state.center.shareCode;
          if(shareCode){
            this.$router.push('/index');
            return;
          }
          this.$router.back();
        }
    },
    computed: {
        ...mapGetters(["user", "account", "token"])
    },
}
</script>


